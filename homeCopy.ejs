<h1>Bon de commande</h1>

<table>
    <caption>Liste des commandes</caption>

    <thead>
        <tr>
            <th>Commande</th>
            <th>Date de la commande</th>
            <th>Date de livraison</th>
            <th>Statut</th>
        </tr>
    </thead>
    <tbody>
        <% data.forEach(order => { %>
            <tr>
                <td>
                    <a href="/detail/<%= order.orderNumber %>"><%= order.orderNumber %></a>
                </td>
                <td><%= order.orderDate.toLocaleDateString() %></td>
                <td><%= order.shippedDate %></td>
                <td><%= order.status %></td>
            </tr>
        <% }); %>

    </tbody>
</table>



// app.get('/', (req, res) => {

    //     pool.query('SELECT * FROM blog', function (error, results, fields){
    //         if(error){
    //             throw Error;
    //         } else {
    //             console.log(results);
    //             res.render("layout", {template: "home", data: results})
    //         }
    //     });
    // })
    
    // app.get('/detail/:id', (req, res)=>{
    //     let id = req.params.id;
        
    //     pool.query(`
    //             SELECT customerName, contactLastName, contactFirstName, addressLine1, city
    //             FROM customers
    //             JOIN orders 
    //             ON orders.customerNumber = customers.customerNumber
    //             WHERE orderNumber = ?
    //         `, [id], (err, customer) => {
    //                 console.log(customer);
    //         pool.query(`
    //                     SELECT productName, priceEach, quantityOrdered, priceEach *quantityOrdered AS totalPrice 
    //                     FROM orderDetails
    //                     JOIN products
    //                     ON products.productCode = orderDetails.productCode
    //                     WHERE orderNumber = ?
    //                 `, [id], function (err, orderDetail){
    //                     console.log(orderDetail);
    
    //                     pool.query('SELECT SUM(priceEach * quantityOrdered) AS totalAmount FROM orderDetails WHERE orderNumber = ?', [id], function (err, result){
    
    //                         let totalAmount = result[0].totalAmount                        
    //                         console.log(totalAmount);
    //                         res.render('layout', {
    //                             template: "detail",
    //                             customer: customer[0],
    //                             orderDetail: orderDetail,
    //                             totalAmount: totalAmount,
    //                             orderNumber: id,
    //                         })
    
    //                     })
    //                 }
    //         )
    
    //     })
    // })
    

    
<section>

    <h1>Bon de commande</h1>

    <a href="/">Back to home</a>

    <article class="order-form-customer">
        <h2><%= customer.customerName %></h2>
        <h3><%= customer.contactFirstName %> <%= customer.contactLastName %></h3>
        <p><%= customer.addressLine1 %></p>
        <p><%= customer.addressLine2 %></p>
        <p><%= customer.city %></p>
    </article>

    <hr>

    <table class="standard-table">

        <caption>Bon de commande nÂ°<%= orderNumber %></caption>

        
        <thead>
            <tr>
                <th>Product</th>
                <th class="money-column">Each price</th>
                <th>Quantity</th>
                <th class="money-column">Total price</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th colspan="3">Total amount HT</th>
                <th><%= totalAmount.toFixed(2) %></th>
            </tr>
            <tr>
                <th colspan="3">TVA 20%</th>
                <th><%= (totalAmount *0.20).toFixed(2) %></th>
            </tr>
            <tr>
                <th colspan="3">Total Amount TTC</th>
                <th><%= (totalAmount *1.20).toFixed(2) %></th>
            </tr>
        </tfoot>

        <tbody>
            <% orderDetail.forEach(product => { %>
                <tr>
                    <td><%= product.productName %></td>               
                    <td class="money-column"><%= product.priceEach.toFixed(2) %></td>               
                    <td><%= product.quantityOrdered %></td>             
                    <td class="money-column"><%= product.totalPrice.toFixed(2) %></td>
                </tr>
                <% }); %>

        </tbody>


    </table>

</section>
